!function(){"use strict";function e(e){for(var r=[],t=255,n=24;n>=0;n-=8)r.push(e>>>n&t);return r}function r(e){for(var r=[],t=127,n=21;n>=0;n-=7)r.push(e>>>n&t);return r}function t(e){for(var r=0,t=21,n=0;t>=0;t-=7,n++)r+=e[n]<<t;return r}function n(e){return e.join("/")||"Unknown Artist"}function a(e){return e.join(";")}function i(e){var r=0;return e.forEach(function(e){r+=e.size}),r}function s(e){var r=10,t=1;return r+t+e}function u(e){var r=10,t=1,n=2,a=2*e;return r+t+n+a}function o(e){var r=10,t=1,n=3,a=2,i=2*e;return r+t+n+a+i}function f(e,r){var t=10,n=1,a=1,i=1;return t+n+r+a+i+a+e}function c(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";var r=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],t=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return r||t?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}function h(e){if(!e||e.constructor!==ArrayBuffer)throw new Error("First argument should be an instance of ArrayBuffer");this.arrayBuffer=e,this.padding=4096,this.frames=[],this.url=""}h.prototype.setFrame=function(e,r){function t(e,r){var t=parseInt(r,10);l.frames.push({name:e,value:t,size:s(t.toString().length)})}function i(e,r){var t=r.toString();l.frames.push({name:e,value:t,size:u(t.length)})}function h(e,r){var t=c(new Uint8Array(r),0,12);if(!t)throw new Error("Unknown picture MIME type");l.frames.push({name:e,value:r,mimeType:t,size:f(r.byteLength,t.length)})}function g(e,r){var t=r.toString();l.frames.push({name:e,value:t,size:o(t.length)})}var l=this;switch(e){case"TPE1":case"TCOM":if(!Array.isArray(r))throw new Error(e+" frame value should be an array of strings");var v=r.map(function(e){return e.toString()}),y=n(v);i(e,y);break;case"TCON":if(!Array.isArray(r))throw new Error(e+" frame value should be an array of strings");var p=r.map(function(e){return e.toString()}),m=a(p);i(e,m);break;case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":i(e,r);break;case"TLEN":case"TYER":t(e,r);break;case"USLT":g(e,r);break;case"APIC":h(e,r);break;default:throw new Error("Unsupported frame "+e)}return this},h.prototype.removeTag=function(){var e=10,r=this.arrayBuffer.byteLength;if(!(e>r)){var n=new Uint8Array(this.arrayBuffer,0,e),a=73===n[0]&&68===n[1]&&51===n[2];if(a){var i=n[3];if(!(2>i||i>4)){var s=t([n[6],n[7],n[8],n[9]]);this.arrayBuffer=this.arrayBuffer.slice(s+e)}}}},h.prototype.addTag=function(){this.removeTag();var t=0,n=10,a=i(this.frames),s=n+a+this.padding,u=new ArrayBuffer(this.arrayBuffer.byteLength+s),o=new Uint8Array(u),f=new TextEncoder("utf-8"),c=new TextEncoder("utf-16le"),h=[73,68,51,3];return o.set(h,t),t+=h.length,t++,t++,h=r(s-n),o.set(h,t),t+=h.length,this.frames.forEach(function(r){switch(h=f.encode(r.name),o.set(h,t),t+=h.length,h=e(r.size-n),o.set(h,t),t+=h.length,t+=2,r.name){case"TPE1":case"TCOM":case"TCON":case"TIT2":case"TALB":case"TPE2":case"TRCK":case"TPOS":h=[1,255,254],o.set(h,t),t+=h.length,h=c.encode(r.value),o.set(h,t),t+=h.length;break;case"USLT":var a=[101,110,103];h=[1].concat(a),o.set(h,t),t+=h.length,t+=2,h=c.encode(r.value),o.set(h,t),t+=h.length;break;case"TLEN":case"TYER":t++,h=f.encode(r.value),o.set(h,t),t+=h.length;break;case"APIC":t++,h=f.encode(r.mimeType),o.set(h,t),t+=h.length,h=[0,3,0],o.set(h,t),t+=h.length,o.set(new Uint8Array(r.value),t),t+=r.value.byteLength}}),t+=this.padding,o.set(new Uint8Array(this.arrayBuffer),t),this.arrayBuffer=u,u},h.prototype.getBlob=function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})},h.prototype.getURL=function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url},h.prototype.revokeURL=function(){URL.revokeObjectURL(this.url)},window.ID3Writer=h}();
//# sourceMappingURL=browser-id3-writer.min.js.map
